var log = 0;
var userJson = [{
  "username" : "Farmer",
   "password" : "Password1"
},
{
  "username" : "Consumer ",
   "password" : "Password1"
}
]
$('document').ready(function(){
  $('#signupform div').each(function(){
     $(this).find('input').attr('disabled','true')
  })
  $('#home').hide();
  $('#signup').hide();
  $('#cart_items').hide();
  $('#navul').hide();
   

    $('#loginButton').click(function(){

      $('#home').show();
      $('#login').hide();
      $('#navul').show();
	  
	  /*
	  // Call get crops services
	  var settings = {
               "async": true,
               "crossDomain": true,
               "url": "http://localhost:5000/api/v1/seasons/allcrops",
               "method": "POST",
               "headers": { 
                 "content-type": "application/json",
                 "authorization": "Basic VFNXYXJlaG91c2U6UGFzc3dvcmQxMjM=",
                 "cache-control": "no-cache",
               },
               "data": ""
             }

             $.ajax(settings).done(function (response) {
               console.log(response);
               if (response.message == "SUCCESS"){
                 console.log(response);
               }
             });
	  
    /*  for (var i=0;i<userJson.length;i++){
      if ($('#username').val() == userJson[i].username && $('#password').val() == userJson[i].password){
        log=1;
        break;
      }
    }
    if (log == 0){
      alert("You have entered wrong username or password");
    }
    else{
      $('#home').show();
      $('#login').hide();
      $('#navul').show();

    }*/
  }); // End -- login

// when register button on login page is clicked
  $('#registerButton').click(function(){
    $('#signup').show();
    $('#login').hide();

  }); // End -- registerButton

  // on  changing user , it will add or remove the necessary/unnecessary fields
  $('#slectUser').on('change',function(){
         var user = $('#slectUser option:selected').val();

             switch(user){
               case "farmer":

               case "government":
               case "consumer":

             }
  })
  
  $("#addSeason").click(function(){
	  alert('button clicked');
	   var inputJSON = {"season" :{
		"name" : "Season Jun17-Oct17",
		"hashkey" : "SOMETHING", 
		"startDate" : "2017-05-14 15:50:44", 
		crops : [ 
			{
			"storageHashkey" : "SOMETHING", 
			"name" : "small corn",
			"pType": "corn", 
			"startDate" : "2017-06-05 00:00:00",
			"endTime": "2017-10-10 12:00:00",
			"quantity ": 250, 
			"unitPrice": "1200INR",
			"unit" : "100KG",
			"log" : [],
			"seeder" : "62da7c15-74f4-4819-9dfe-58c4076c8e52", 
			"status":"created",
			},
			{
			"storageHashkey" : "SOMETHING", 
			"name" : "Moong Dal",
			"pType": "dal", 
			"startDate" : "2017-06-05 00:00:00",
			"endTime": "2017-10-10 12:00:00",
			"quantity ": 10, 
			"unitPrice": "4200INR",
			"unit" : "100KG",
			"log" : [],
			"seeder" : "62da7c15-74f4-4819-9dfe-58c4076c8e52", 
			"status":"created",
			}
		],
			'producerID':'xyz',
		"status":"cretaed",
	   }};
		alert("initializing contract");
		
		var Web3 = require('web3');
    var web3 = new Web3();
    web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545")); 
	
var code = "" +    "0x60606040526000805463ffffffff1916600517905534610000575b60006001555b5b611469806100306000396000f3006060604052361561005c5763ffffffff60e060020a6000350416633a96fdd781146100615780635171071f146101035780635bb6671b14610122578063b9e2a7ff146102c1578063c038cb2c14610365578063f40704ae14610586575b610000565b34610000576100f1600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b018035918201839004830284018301909452808352979998810197919650918201945092508291508401838280828437509496506105eb95505050505050565b60408051918252519081900360200190f35b34610000576100f161072c565b60408051918252519081900360200190f35b34610000576102ad600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f818a01358b0180359182018390048302840183018552818452989a8a359a909994019750919550918201935091508190840183828082843750949650509335935061073392505050565b604080519115158252519081900360200190f35b34610000576102ad600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b01803591820183900483028401830190945280835297999881019791965091820194509250829150840183828082843750949650610d3c95505050505050565b604080519115158252519081900360200190f35b34610000576102ad600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020888301358a018035601f81018390048302840183019094528383529799893599808301359991985060600196509194509081019250819084018382808284375050604080516020601f89358b0180359182018390048302840183019094528083529799988101979196509182019450925082915084018382808284375050604080516020601f818a01358b0180359182018390048302840183018552818452989a8a359a909994019750919550918201935091508190840183828082843750949650610e1995505050505050565b604080519115158252519081900360200190f35b34610000576100f1600480803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284375094965061136295505050505050565b60408051918252519081900360200190f35b6040805160208181018352600091829052825190810190925290819052825182518491849184908290101561061f57825191505b5060005b818110156106f457828181518110156100005790602001015160f860020a900460f860020a02600160f860020a031916848281518110156100005790602001015160f860020a900460f860020a02600160f860020a031916101561068b576000199450610720565b828181518110156100005790602001015160f860020a900460f860020a02600160f860020a031916848281518110156100005790602001015160f860020a900460f860020a02600160f860020a03191611156106ea5760019450610720565b5b5b600101610623565b825184511015610708576000199450610720565b82518451111561071b5760019450610720565b600094505b5b5b5050505092915050565b6001545b90565b600080546001548291829163ffffffff90911690106107555760009250610d2e565b3391508a6002600060015481526020019081526020016000206000019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106107ba57805160ff19168380011785556107e7565b828001600101855582156107e7579182015b828111156107e75782518255916020019190600101906107cc565b5b506108089291505b8082111561080457600081556001016107f0565b5090565b5050896002600060015481526020019081526020016000206001019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061086c57805160ff1916838001178555610899565b82800160010185558215610899579182015b8281111561089957825182559160200191906001019061087e565b5b506108ba9291505b8082111561080457600081556001016107f0565b5090565b5050886002600060015481526020019081526020016000206002019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061091e57805160ff191683800117855561094b565b8280016001018555821561094b579182015b8281111561094b578251825591602001919060010190610930565b5b5061096c9291505b8082111561080457600081556001016107f0565b5090565b5050876002600060015481526020019081526020016000206003019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106109d057805160ff19168380011785556109fd565b828001600101855582156109fd579182015b828111156109fd5782518255916020019190600101906109e2565b5b50610a1e9291505b8082111561080457600081556001016107f0565b5090565b5050866002600060015481526020019081526020016000206004019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610a8257805160ff1916838001178555610aaf565b82800160010185558215610aaf579182015b82811115610aaf578251825591602001919060010190610a94565b5b50610ad09291505b8082111561080457600081556001016107f0565b5090565b50506001805460009081526002602081815260408084206005018b905584548452808420600601849055845484528320895160089091018054818652948390209095851615610100026000190190941692909204601f908101829004840193918a0190839010610b4b57805160ff1916838001178555610b78565b82800160010185558215610b78579182015b82811115610b78578251825591602001919060010190610b5d565b5b50610b999291505b8082111561080457600081556001016107f0565b5090565b5050600180546000908152600260208181526040808420600901805473ffffffffffffffffffffffffffffffffffffffff191673ffffffffffffffffffffffffffffffffffffffff891617905580518082018252600781527f6372656174656400000000000000000000000000000000000000000000000000818401908152865486528484529185209051600a909101805481875295849020909661010090871615026000190190951693909304601f9081019290920484019391839010610c6c57805160ff1916838001178555610c99565b82800160010185558215610c99579182015b82811115610c99578251825591602001919060010190610c7e565b5b50610cba9291505b8082111561080457600081556001016107f0565b5090565b5050600180546000908152600260208181526040808420600c9081018590558554855281852080820154808752600b918201855283872042905587548752858552838720818852909101845282862087018b9055865486529390925290922090910180548301905581548201825590935090505b505098975050505050505050565b60006000610d4984611362565b90508060631415610d5d5760009150610e12565b82600260008381526020019081526020016000206008019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610dbd57805160ff1916838001178555610dea565b82800160010185558215610dea579182015b82811115610dea578251825591602001919060010190610dcf565b5b50610e0b9291505b8082111561080457600081556001016107f0565b5090565b5050600191505b5092915050565b600060006000610e288e611362565b91508160631415610e3c5760009250611351565b3390508c600260008481526020019081526020016000206001019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610e9f57805160ff1916838001178555610ecc565b82800160010185558215610ecc579182015b82811115610ecc578251825591602001919060010190610eb1565b5b50610eed9291505b8082111561080457600081556001016107f0565b5090565b50508b600260008481526020019081526020016000206002019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610f4f57805160ff1916838001178555610f7c565b82800160010185558215610f7c579182015b82811115610f7c578251825591602001919060010190610f61565b5b50610f9d9291505b8082111561080457600081556001016107f0565b5090565b50508a600260008481526020019081526020016000206003019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610fff57805160ff191683800117855561102c565b8280016001018555821561102c579182015b8281111561102c578251825591602001919060010190611011565b5b5061104d9291505b8082111561080457600081556001016107f0565b5090565b505089600260008481526020019081526020016000206004019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106110af57805160ff19168380011785556110dc565b828001600101855582156110dc579182015b828111156110dc5782518255916020019190600101906110c1565b5b506110fd9291505b8082111561080457600081556001016107f0565b5090565b505060008281526002602081815260408320600581018d9055600681018c90558a5160079091018054818652948390209094600181161561010002600019011693909304601f90810183900484019391928c019083901061116957805160ff1916838001178555611196565b82800160010185558215611196579182015b8281111561119657825182559160200191906001019061117b565b5b506111b79291505b8082111561080457600081556001016107f0565b5090565b505085600260008481526020019081526020016000206008019080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061121957805160ff1916838001178555611246565b82800160010185558215611246579182015b8281111561124657825182559160200191906001019061122b565b5b506112679291505b8082111561080457600081556001016107f0565b5090565b50506000828152600260208181526040832060098101805473ffffffffffffffffffffffffffffffffffffffff191673ffffffffffffffffffffffffffffffffffffffff87161790558751600a9091018054818652948390209094610100600182161502600019011693909304601f90810183900484019391928901908390106112fc57805160ff1916838001178555611329565b82800160010185558215611329579182015b8281111561132957825182559160200191906001019061130e565b5b5061134a9291505b8082111561080457600081556001016107f0565b5090565b5050600192505b50509b9a5050505050505050505050565b60008080805b60015483101561143057600083815260026020818152604092839020805484516001821615610100026000190190911693909304601f810183900483028401830190945283835294506114139285918301828280156114085780601f106113dd57610100808354040283529160200191611408565b820191906000526020600020905b8154815290600101906020018083116113eb57829003601f168201915b5050505050866105eb565b905080151561142457829350611435565b5b600190920191611368565b606393505b5050509190505600a165627a7a72305820e1e3569adb099f56c1110539682114c84838195f9cf9c12e4ae8a417c6f9259d0029";

	var abi = [
    {
      "constant": false,
      "inputs": [
        {
          "name": "_a",
          "type": "string"
        },
        {
          "name": "_b",
          "type": "string"
        }
      ],
      "name": "compare",
      "outputs": [
        {
          "name": "",
          "type": "int256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "getTotItems",
      "outputs": [
        {
          "name": "",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "hashkey",
          "type": "string"
        },
        {
          "name": "pname",
          "type": "string"
        },
        {
          "name": "protype",
          "type": "string"
        },
        {
          "name": "sdate",
          "type": "string"
        },
        {
          "name": "eTime",
          "type": "string"
        },
        {
          "name": "qty",
          "type": "uint256"
        },
        {
          "name": "log",
          "type": "string"
        },
        {
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "registerNewCrop",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "hashkey",
          "type": "string"
        },
        {
          "name": "log",
          "type": "string"
        }
      ],
      "name": "logWork",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "hashkey",
          "type": "string"
        },
        {
          "name": "pname",
          "type": "string"
        },
        {
          "name": "protype",
          "type": "string"
        },
        {
          "name": "sdate",
          "type": "string"
        },
        {
          "name": "eTime",
          "type": "string"
        },
        {
          "name": "qty",
          "type": "uint256"
        },
        {
          "name": "unitPrice",
          "type": "uint256"
        },
        {
          "name": "unit",
          "type": "string"
        },
        {
          "name": "log",
          "type": "string"
        },
        {
          "name": "amount",
          "type": "uint256"
        },
        {
          "name": "status",
          "type": "string"
        }
      ],
      "name": "updateCropInfo",
      "outputs": [
        {
          "name": "",
          "type": "bool"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [
        {
          "name": "hashkey",
          "type": "string"
        }
      ],
      "name": "verifyCrop",
      "outputs": [
        {
          "name": "index",
          "type": "uint256"
        }
      ],
      "payable": false,
      "type": "function"
    },
    {
      "inputs": [],
      "payable": false,
      "type": "constructor"
    }
  ];
    var myContract;
		// let's assume that coinbase is our account
        web3.eth.defaultAccount = web3.eth.coinbase;
		alert(web3.eth.defaultAccount);
        // create contract
        alert("transaction sent, waiting for confirmation");
        web3.eth.contract(abi).new({data: code, gas:4700000}, function (err, contract) {
            if (err) {
                console.error(err);
                return;

            // callback fires twice, we only want the second call when the contract is deployed
            } else if(contract.address){

                myContract = contract;
                console.log('address: ' + myContract.address);
				alert('Done and mined');
				// call the contract
				seasons = inputJSON["season"];
				var res = myContract.registerNewCrop(seasons["storageHashkey"], seasons["name"], seasons["pType"], seasons["startDate"], 
													seasons["endTime"], seasons["quantity"], seasons["log"], 1200);
				alert (res);
				console.write(res);
            }
        });
	alert('Contract Done')
		
	//call the contract
	// write to mongoDB
	var callRegisterNewSeason = {
               "async": true,
               "crossDomain": true,
               "url": "http://localhost:5000/api/v1/seasons/add",
               "method": "POST",
               "headers": {
                 "content-type": "application/json",
                 "authorization": "Basic VFNXYXJlaG91c2U6UGFzc3dvcmQxMjM=",
                 "cache-control": "no-cache",
               },
               "data": JSON.stringify(inputJSON)
             }

             $.ajax(callRegisterNewSeason).done(function (response) { 
			   alert(response);
             }); 
     
  });

//Register button in Register form is clicked to register a user
$("#register").click(function(){
  var name = $('#firstname').val()+$('#middlename').val()+$('#lastname').val();
  var aadhar = $("#aadharid").val();
  var address= $('#address').val();
  var contact = $('#contact').val();
  var password = $('#registerpassword').val();
  var user = $('#slectUser option:selected').val();
  switch(user){
    case "farmer":

    case "government":
    case "consumer":
    var registerUser = {
        "consumer" : {
          "name" : name,
          "aadhar" : aadhar,
          "user" : user,
          "password" : passowrd,
          "address" : address,
          "contact" : contact,
        }
    }
     var settings = {
               "async": true,
               "crossDomain": true,
               "url": "http://127.0.0.1:5000/api/v1/consumers/register",
               "method": "POST",
               "headers": {
                 "content-type": "application/json",
                 "authorization": "Basic VFNXYXJlaG91c2U6UGFzc3dvcmQxMjM=",
                 "cache-control": "no-cache",
               },
               "data": JSON.stringify(registerUser)
             }

             $.ajax(settings).done(function (response) {
               console.log(response);
               if (response.message == "SUCCESS"){
                 $('#signup').hide();
                 $('#login').show();
               }
             });

  } // End -- switch Case

});



}); //End -- Document ready funnction

/*
$(function() {
  var mapOptions = {
    zoom: 8,
    center: new google.maps.LatLng(-34.397, 150.644)
  };
  var map = new google.maps.Map($("#map")[0], mapOptions);

  // listen for the window resize event & trigger Google Maps to update too
  $(window).resize(function() {
    // (the 'map' here is the result of the created 'var map = ...' above)
    google.maps.event.trigger(map, "resize");
  });
});
*/
$(function(){
$('#navul li').click(function(){
  console.log(this);
  var section = $(this).find('a').attr('href');
  switch(section){
    case "#home" :
      $("#")
  }
})
});
